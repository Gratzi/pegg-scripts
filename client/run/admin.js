// Generated by CoffeeScript 1.9.3
(function() {
  var Admin, hashChange, hidePages, io;

  io = window.io.connect();

  io.on('message', function(data) {
    if (data.taskName != null) {
      return $("#" + data.taskName + "_detail").append(data.message + "<br/>");
    } else {
      return console.log("server says: ", data.message);
    }
  });

  io.on('done', function(data) {
    $("#" + data.taskName + "_message").html(data.message).parent().addClass('has-success');
    return $("#" + data.taskName + "_detail").append("done!<br/>");
  });

  io.on('error', function(data) {
    var fullMessage, message, ref, ref1;
    message = (ref = data != null ? (ref1 = data.error) != null ? ref1.message : void 0 : void 0) != null ? ref : 'Unknown error occurred';
    fullMessage = "ERROR: " + message + " (see server output for details)";
    $("#" + data.taskName + "_message").html(message).parent().addClass('has-error');
    $("#" + data.taskName + "_detail").append(fullMessage + "<br/>");
    return console.warn(fullMessage);
  });

  Admin = {
    deleteCard: function(cardId) {
      console.log("deleting card " + cardId);
      $('#deleteCard_message').html("working ...").parent().removeClass('has-success').removeClass('has-error');
      $('#deleteCard_detail').html("");
      return io.emit("deleteCard", cardId);
    },
    resetUser: function(userId) {
      console.log("resetting user " + userId);
      $('#resetUser_message').html("working ...").parent().removeClass('has-success').removeClass('has-error');
      $('#resetUser_detail').html("");
      return io.emit("resetUser", userId);
    },
    migrateS3: function() {
      console.log("migrating image content to S3");
      $('#migrateS3_message').html("working ...").parent().removeClass('has-success').removeClass('has-error');
      $('#migrateS3_detail').html("");
      return io.emit("migrateS3");
    }
  };

  window.Admin = Admin;

  hidePages = function() {
    return $(".page").hide();
  };

  window.onhashchange = hashChange = function() {
    console.log("showing page " + window.location.hash);
    hidePages();
    return $(window.location.hash).show();
  };

  $(document).ready(function() {
    $('#deleteCard').on('submit', function() {
      Admin.deleteCard($('#deleteCard_id').val());
      return false;
    });
    $('#resetUser').on('submit', function() {
      Admin.resetUser($('#resetUser_id').val());
      return false;
    });
    $('#migrateS3').on('submit', function() {
      Admin.migrateS3();
      return false;
    });
    if (window.location.hash) {
      hashChange();
    }
    return io.emit('ready');
  });

}).call(this);
